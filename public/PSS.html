<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Secure Note</title>
</head>
<body>
  <h1>Secure Note</h1>
  <div id="note">Enter the correct key in the URL to reveal the note.</div>

  <script>
  async function decryptAES(encryptedHex, passphrase) {
    const enc = new TextEncoder();
    const dec = new TextDecoder();

    const encryptedBytes = new Uint8Array(encryptedHex.match(/.{1,2}/g).map(b => parseInt(b, 16)));

    const iv = encryptedBytes.slice(0, 12);
    const ciphertext = encryptedBytes.slice(12);

    const keyMaterial = await crypto.subtle.digest('SHA-256', enc.encode(passphrase));

    const cryptoKey = await crypto.subtle.importKey(
      'raw',
      keyMaterial,
      'AES-GCM',
      false,
      ['decrypt']
    );

    const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, cryptoKey, ciphertext);

    return dec.decode(decrypted);
  }

  const encryptedNote = "614517357d051955db32b443fd94a744b820f22ccd31c0cab97382f4e06f1fc2b75cbd73abbf57b40c14b92bb8605bb44e"; 

  const urlParams = new URLSearchParams(window.location.search);
  const key = urlParams.get('key');

  if (key) {
    decryptAES(encryptedNote, key)
      .then(text => {
        document.getElementById('note').textContent = text;
      })
      .catch(err => {
        document.getElementById('note').textContent = 'Invalid key or corrupted note.';
      });
  }
</script>
</body>
</html>
